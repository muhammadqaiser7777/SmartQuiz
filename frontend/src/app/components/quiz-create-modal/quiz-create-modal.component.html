<div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Create New Quiz</h2>
            <button class="close-btn" (click)="closeModal()">×</button>
        </div>

        <div class="modal-body">
            <div *ngIf="error" class="error-message">
                {{ error }}
            </div>

            <!-- Quiz Details Section -->
            <div class="form-section">
                <h3>Quiz Details</h3>

                <div class="form-group">
                    <label for="quizTitle">Quiz Title *</label>
                    <input type="text" id="quizTitle" [(ngModel)]="quizTitle" placeholder="Enter quiz title"
                        class="form-control" />
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="startTime">Start Time *</label>
                        <input type="datetime-local" id="startTime" [(ngModel)]="startTime"
                            (ngModelChange)="onStartTimeChange()" class="form-control" />
                    </div>

                    <div class="form-group">
                        <label for="timeLimit">Time Limit (minutes) *</label>
                        <input type="number" id="timeLimit" [(ngModel)]="timeLimit"
                            (ngModelChange)="onTimeLimitChange()" [min]="MIN_TIME_LIMIT" [max]="MAX_TIME_LIMIT"
                            class="form-control" />
                        <small class="help-text">Max: {{ MAX_TIME_LIMIT }} minutes</small>
                    </div>
                </div>

                <div class="form-group" *ngIf="endTime">
                    <label>End Time (Auto-calculated)</label>
                    <div class="calculated-end-time">{{ endTime }}</div>
                </div>

                <div class="form-group">
                    <label for="totalMarks">Total Marks *</label>
                    <input type="number" id="totalMarks" [(ngModel)]="totalMarks" placeholder="Enter total marks"
                        min="1" class="form-control" />
                </div>
            </div>

            <!-- Questions Section -->
            <div class="form-section">
                <h3>Questions ({{ questions.length }})</h3>

                <!-- Current Question Form -->
                <div class="question-form">
                    <div class="form-group">
                        <label>Question *</label>
                        <textarea [(ngModel)]="currentQuestion.question" placeholder="Enter your question"
                            class="form-control" rows="2"></textarea>
                    </div>

                    <div class="options-grid">
                        <div class="option-input">
                            <label>Option A *</label>
                            <input type="text" [(ngModel)]="currentQuestion.optionA" placeholder="Option A"
                                class="form-control" />
                        </div>
                        <div class="option-input">
                            <label>Option B *</label>
                            <input type="text" [(ngModel)]="currentQuestion.optionB" placeholder="Option B"
                                class="form-control" />
                        </div>
                        <div class="option-input">
                            <label>Option C *</label>
                            <input type="text" [(ngModel)]="currentQuestion.optionC" placeholder="Option C"
                                class="form-control" />
                        </div>
                        <div class="option-input">
                            <label>Option D *</label>
                            <input type="text" [(ngModel)]="currentQuestion.optionD" placeholder="Option D"
                                class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Correct Option *</label>
                        <select [(ngModel)]="currentQuestion.correctOption" class="form-control">
                            <option value="1">Option A</option>
                            <option value="2">Option B</option>
                            <option value="3">Option C</option>
                            <option value="4">Option D</option>
                        </select>
                    </div>

                    <button type="button" class="btn btn-secondary" (click)="addQuestion()">
                        + Add Question
                    </button>
                </div>

                <!-- Added Questions List -->
                <div *ngIf="questions.length > 0" class="questions-list">
                    <h4>Added Questions</h4>
                    <div *ngFor="let q of questions; let i = index" class="question-item">
                        <div class="question-header">
                            <span class="question-number">Q{{ i + 1 }}</span>
                            <button class="remove-btn" (click)="removeQuestion(i)">×</button>
                        </div>
                        <p class="question-text">{{ q.question }}</p>
                        <div class="options-preview">
                            <span [class.correct]="q.correctOption === '1'">A: {{ q.optionA }}</span>
                            <span [class.correct]="q.correctOption === '2'">B: {{ q.optionB }}</span>
                            <span [class.correct]="q.correctOption === '3'">C: {{ q.optionC }}</span>
                            <span [class.correct]="q.correctOption === '4'">D: {{ q.optionD }}</span>
                        </div>
                        <p class="correct-answer">Correct: Option {{ q.correctOption }}</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">
                Cancel
            </button>
            <button type="button" class="btn btn-primary" (click)="createQuiz()" [disabled]="loading">
                {{ loading ? 'Creating...' : 'Create Quiz' }}
            </button>
        </div>
    </div>
</div>